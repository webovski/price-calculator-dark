<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä</title>
    <link rel="stylesheet" type="text/css" href="./assets/styles.css">
    <script src="https://kit.fontawesome.com/f8d97f667d.js" crossorigin="anonymous"></script>
</head>
<body>
<!-- Language Switcher (Flag icons) -->
<div class="navigation">
    <div class="logo">
        <a href="/">Pricer.cc</a>
    </div>
    <div class="lang-container">
        <img src="https://flagcdn.com/w20/ru.png" srcset="https://flagcdn.com/w40/ru.png 2x" id="lang-ru" onclick="changeLanguage('ru')" width="20" alt="Russia">
        <img src="https://flagcdn.com/w20/us.png" srcset="https://flagcdn.com/w40/us.png 2x" id="lang-en" onclick="changeLanguage('en')" width="20" alt="English">
        <img src="https://flagcdn.com/w20/ua.png" srcset="https://flagcdn.com/w40/ua.png 2x" id="lang-ua" onclick="changeLanguage('ua')" width="20" alt="Ukraine">
    </div>
</div>
<h1 id="title">‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä</h1>
<h2 id="subtitle">üíµ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–∫–ª–∞–º—É –ø–æ–¥ –í–∞—à –±—é–¥–∂–µ—Ç</h2>

<div class="slider-container">
    <label for="chat-range" id="label-range">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ö–≤–∞—Ç:</label>
    <input type="range" id="chat-range" min="1" value="1" step="1">
    <label for="duration-range" id="label-duration">–í—ã–±–µ—Ä–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–Ω–µ–π):</label>
    <input type="range" id="duration-range" min="1" max="365" value="1" step="1">
    <div class="output" id="output-duration">
        <span id="label-duration-days">üïí –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: </span><span id="selected-duration">1</span>
    </div>
    <!-- Separate spans for output-chats and output-price -->
    <div class="output" id="output-chats">
        <span id="label-chats">üí¨ –ß–∏—Å–ª–æ —á–∞—Ç–æ–≤: </span><span id="selected-chats">1</span>
    </div>
    <div class="output" id="output-users">
        <span id="label-users">–í–∞—à—É —Ä–µ–∫–ª–∞–º—É —É–≤–∏–¥–∏—Ç </span><span id="audience-count">0</span> üôÑ
    </div>
    <div class="output" id="output-price">
        <span id="label-price">–°—Ç–æ–∏–º–æ—Å—Ç—å: </span><span id="total-price">0.00</span><span style="color: #5aec8c">$</span>
    </div>
    <div class="tip" id="discount-tip">
        <span id="label-discount">üî• –°–∫–∏–¥–∫–∞: </span><span id="discount-value">0%</span>
    </div>
</div>


<div class="chat-list" id="chat-list">
    <!-- Chat items will be dynamically added here -->
</div>

<script>
    // Language data
    const langData = {
        ru: {
            title: "‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä",
            subtitle: "üíµ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–∫–ª–∞–º—É –ø–æ–¥ –í–∞—à –±—é–¥–∂–µ—Ç",
            labelRange: "–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ö–≤–∞—Ç:",
            outputChats: "üí¨ –ß–∏—Å–ª–æ —á–∞—Ç–æ–≤: ",
            outputUsers: "–í–∞—à—É —Ä–µ–∫–ª–∞–º—É —É–≤–∏–¥–∏—Ç ",
            outputPrice: "–°—Ç–æ–∏–º–æ—Å—Ç—å: ",
            discountTip: "üî• –°–∫–∏–¥–∫–∞: ",
            participants: "—á–µ–ª–æ–≤–µ–∫",
            labelDuration: "–í—ã–±–µ—Ä–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–Ω–µ–π):",
            outputDuration: "üïí –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ",
            durationDays: ["–¥–µ–Ω—å", "–¥–Ω—è", "–¥–Ω–µ–π"], // Singular, few, many
            telegramButtonText: "–ó–∞–∫–∞–∑–∞—Ç—å —Ä–µ–∫–ª–∞–º—É" // –ü–µ—Ä–µ–≤–æ–¥ –¥–ª—è –∫–Ω–æ–ø–∫–∏
        },
        en: {
            title: "‚öôÔ∏è Configurator",
            subtitle: "üíµ Adjust the ad for your budget",
            labelRange: "Select reach:",
            outputChats: "üí¨ Number of chats: ",
            outputUsers: "Your ad will be seen by ",
            outputPrice: "Cost: ",
            discountTip: "üî• Discount: ",
            participants: "people",
            labelDuration: "Select duration (days):",
            outputDuration: "üïí Duration: ",
            durationDays: ["day", "days", "days"], // Singular, plural (English doesn't need the "few" case)
            telegramButtonText: "Order ADS" // –ü–µ—Ä–µ–≤–æ–¥ –¥–ª—è –∫–Ω–æ–ø–∫–∏
        },
        ua: {
            title: "‚öôÔ∏è –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ç–æ—Ä",
            subtitle: "üíµ –ù–∞–ª–∞—à—Ç—É–π—Ç–µ —Ä–µ–∫–ª–∞–º—É –ø—ñ–¥ –í–∞—à –±—é–¥–∂–µ—Ç",
            labelRange: "–í–∏–±–µ—Ä—ñ—Ç—å –æ—Ö–æ–ø–ª–µ–Ω–Ω—è:",
            outputChats: "üí¨ –ö—ñ–ª—å–∫—ñ—Å—Ç—å —á–∞—Ç—ñ–≤: ",
            outputUsers: "–í–∞—à—É —Ä–µ–∫–ª–∞–º—É –ø–æ–±–∞—á–∞—Ç—å ",
            outputPrice: "–í–∞—Ä—Ç—ñ—Å—Ç—å: ",
            discountTip: "üî• –ó–Ω–∏–∂–∫–∞: ",
            participants: "–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤",
            labelDuration: "–í–∏–±–µ—Ä—ñ—Ç—å —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å (–¥–Ω—ñ–≤):",
            outputDuration: "üïí –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å: ",
            durationDays: ["–¥–µ–Ω—å", "–¥–Ω—ñ", "–¥–Ω—ñ–≤"], // Singular, few, many
            telegramButtonText: "–ó–∞–º–æ–≤–∏—Ç–∏ —Ä–µ–∫–ª–∞–º—É" // –ü–µ—Ä–µ–≤–æ–¥ –¥–ª—è –∫–Ω–æ–ø–∫–∏
        }
    };

    let currentLang = 'ru';  // Default language is Russian (ru)

    const durationDiscountTiers = [
        { maxDays: 7, extraDiscount: 0.01 },   // 1% extra discount for 1-7 days (previously 2%)
        { maxDays: 14, extraDiscount: 0.025 },  // 2.5% extra discount for 8-14 days (previously 5%)
        { maxDays: 21, extraDiscount: 0.04 },   // 4% extra discount for 15-21 days (previously 8%)
        { maxDays: 30, extraDiscount: 0.06 },   // 6% extra discount for 22-30 days (previously 12%)
        { maxDays: 60, extraDiscount: 0.09 },   // 9% extra discount for 31-60 days (previously 18%)
        { maxDays: 90, extraDiscount: 0.125 },  // 12.5% extra discount for 61-90 days (previously 25%)
        { maxDays: 180, extraDiscount: 0.175 }, // 17.5% extra discount for 91-180 days (previously 35%)
        { maxDays: 365, extraDiscount: 0.25 },  // 25% extra discount for 181-365 days (previously 50%)
    ];

    const discountTiers = [
        { maxUsers: 100000, rate: 0.0016 },
        { maxUsers: 250000, rate: 0.00158 },
        { maxUsers: 500000, rate: 0.00155 },
        { maxUsers: 750000, rate: 0.00151 },
        { maxUsers: 1000000, rate: 0.00149 },
        { maxUsers: 1500000, rate: 0.0014 }
    ];

    let chats = []; // Variable to hold chat data

    // Select DOM elements
    const chatRange = document.getElementById('chat-range');
    const selectedChats = document.getElementById('selected-chats');
    const audienceCount = document.getElementById('audience-count');
    const totalPrice = document.getElementById('total-price');
    const discountTip = document.getElementById('discount-tip');
    const chatList = document.getElementById('chat-list');
    const title = document.getElementById('title');
    const subtitle = document.getElementById('subtitle');
    const labelRange = document.getElementById('label-range');
    const labelChats = document.getElementById('label-chats');
    const labelUsers = document.getElementById('label-users');
    const labelPrice = document.getElementById('label-price');
    const labelDiscount = document.getElementById('label-discount');

    // Fetch the chats.txt file from the server
    fetch('chats.txt')
        .then(response => response.text())
        .then(data => {
            parseChatData(data);  // Parse the content of the file
            updateStats();  // Update stats after data is loaded
        })
        .catch(error => {
            console.error('Error fetching the chat file:', error);
        });

    // Parse chat data from the fetched text file
    function parseChatData(text) {
        const lines = text.split('\n');
        chats = lines.map(line => {
            const [username, members] = line.split(':');
            return { username: username.trim(), members: parseInt(members.trim()) };
        });

        // Sort chats by number of members descending
        chats.sort((a, b) => b.members - a.members);

        // Set max range to the total number of chats
        chatRange.max = chats.length;
    }

    // Calculate cost per user based on discount tiers
    function calculateCost(users) {
        let totalCost = 0;
        let remainingUsers = users;

        for (const tier of discountTiers) {
            if (remainingUsers <= 0) break;

            const tierUsers = Math.min(remainingUsers, tier.maxUsers);
            totalCost += tierUsers * tier.rate;
            remainingUsers -= tierUsers;
        }

        return totalCost;
    }

    // Get discount percentage based on current cost per user
    function getDiscountPercentage(totalCost, users) {
        const baseCost = users * discountTiers[0].rate; // Without discount
        return Math.round((1 - totalCost / baseCost) * 100);
    }

    // Select the duration slider and display elements
    const durationRange = document.getElementById('duration-range');
    const selectedDuration = document.getElementById('selected-duration');

    // Calculate the duration discount based on the selected days
    function calculateDurationDiscount(days) {
        let extraDiscount = 0;

        for (const tier of durationDiscountTiers) {
            if (days <= tier.maxDays) {
                extraDiscount = tier.extraDiscount;
                break;
            }
        }

        return extraDiscount;
    }

    // Updated updateStats Function
    function updateStats() {
        const chatCount = parseInt(chatRange.value, 10) || 1;
        const durationDays = parseInt(durationRange.value, 10) || 1;
        const selectedChatsList = chats.slice(0, chatCount);

        const totalUsers = selectedChatsList.reduce((sum, chat) => sum + chat.members, 0);
        const baseCost = calculateCost(totalUsers);

        // Calculate total discounts
        const chatDiscount = getDiscountPercentage(baseCost, totalUsers); // Discount from chat tiers
        const durationDiscount = calculateDurationDiscount(durationDays); // Additional discount from duration

        const totalDiscount = chatDiscount + Math.round(durationDiscount * 100); // Combine discounts
        const finalCost = baseCost * (1 - durationDiscount); // Apply duration discount

        // Get correct word for duration
        const durationWord = getDurationWord(durationDays, currentLang);

        // Update UI
        selectedChats.textContent = chatCount;
        audienceCount.textContent = `${totalUsers.toLocaleString()} ${langData[currentLang].participants}`;
        totalPrice.textContent = finalCost.toFixed(2);
        discountTip.textContent = `${langData[currentLang].discountTip} ${totalDiscount}%`;
        selectedDuration.textContent = `${durationDays} ${durationWord}`;

        // Update chat list dynamically
        chatList.innerHTML = selectedChatsList.map(chat => `
            <div class="chat-item">
                <a href='https://t.me/${chat.username}' target="_blank">@${chat.username}: ${chat.members.toLocaleString()} ${langData[currentLang].participants}</a>
            </div>
        `).join('');
    }

    // Attach event listener to the duration slider
    durationRange.addEventListener('input', updateStats);

    // Attach the chat range slider listener
    chatRange.addEventListener('input', updateStats);

    // Update stats on load
    updateStats();

    // Attach event listener to slider input
    chatRange.addEventListener('input', updateStats);

    // Language change handler
    // Updated changeLanguage Function
    function changeLanguage(lang) {
        if (langData[lang]) {
            currentLang = lang;

            // Update static text
            title.textContent = langData[currentLang].title;
            subtitle.textContent = langData[currentLang].subtitle;
            labelRange.textContent = langData[currentLang].labelRange;
            labelChats.textContent = langData[currentLang].outputChats;
            labelUsers.textContent = langData[currentLang].outputUsers;
            labelPrice.textContent = langData[currentLang].outputPrice;
            labelDiscount.textContent = langData[currentLang].discountTip;
            document.getElementById('label-duration').textContent = langData[currentLang].labelDuration;
            document.getElementById('label-duration-days').textContent = langData[currentLang].outputDuration;
            document.getElementById('telegram-text').textContent = langData[currentLang].telegramButtonText;

            // Re-render dynamic elements
            updateStats();
        }
    }
    function getDurationWord(days, lang) {
        const words = langData[lang].durationDays;

        if (lang === "ru" || lang === "ua") {
            if (days % 10 === 1 && days % 100 !== 11) return words[0]; // Singular: 1, 21, 31...
            if ([2, 3, 4].includes(days % 10) && ![12, 13, 14].includes(days % 100)) return words[1]; // Few: 2-4, 22-24...
            return words[2]; // Many: 5-20, 25-30, etc.
        } else if (lang === "en") {
            return days === 1 ? words[0] : words[1]; // Singular for 1, plural otherwise
        }

        return words[2]; // Default to "many" case
    }
</script>
<!-- Floating button for Telegram link -->
<a href="https://t.me/Alexeevpr" target="_blank" class="floating-button">
    <i class="fa-brands fa-telegram fa-xl"></i>
    <span id="telegram-text">–ó–∞–∫–∞–∑–∞—Ç—å —Ä–µ–∫–ª–∞–º—É</span>
</a>
</body>
</html>